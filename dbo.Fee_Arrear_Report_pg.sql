CREATE OR REPLACE FUNCTION "dbo"."Fee_Arrear_Report"(
    "p_amay_id" VARCHAR(50),
    "p_asmcl_id" VARCHAR(50),
    "p_amcl_id" VARCHAR(50),
    "p_amst_id" BIGINT,
    "p_fmt_id" VARCHAR(50),
    "p_mi_id" VARCHAR(50),
    "p_fmg_id" VARCHAR(50),
    "p_userid" VARCHAR(50),
    "p_fmgg_id" VARCHAR(50),
    "p_trmr_id" VARCHAR(50)
)
RETURNS TABLE(
    "AMST_Id" BIGINT,
    "Name" TEXT,
    "AMST_AdmNo" VARCHAR,
    "fyp_receipt_no" VARCHAR,
    "date" TEXT,
    "Balance" NUMERIC,
    "paid" NUMERIC,
    "Total" NUMERIC,
    "opening_balance" NUMERIC,
    "Excess" NUMERIC,
    "Waived" NUMERIC,
    "refunded" NUMERIC,
    "adjusted" NUMERIC,
    "ASMCL_ClassName" VARCHAR,
    "ASMC_SectionName" VARCHAR,
    "FMT_Name" VARCHAR,
    "FMT_Id" BIGINT,
    "TRMR_RouteName" VARCHAR,
    "FMCC_ConcessionName" VARCHAR,
    "TRMR_RouteNo" VARCHAR
)
LANGUAGE plpgsql
AS $$
DECLARE
    "v_fti_id" TEXT;
    "v_fmh_id" TEXT;
    "v_sqlinstall" TEXT;
    "v_sqlhead" TEXT;
    "v_monthyearsd" TEXT;
    "v_headid" TEXT;
    "v_query" TEXT;
    "v_temp" BIGINT;
    "v_temphead" BIGINT;
    "v_Row_count" BIGINT;
    "v_str1" TEXT;
BEGIN

    IF "p_trmr_id" = '0' THEN
        IF "p_amcl_id" != '0' THEN
            "v_str1" := 'and ("Adm_School_M_Class"."ASMCL_Id" = ' || "p_asmcl_id" || ') and ("adm_school_m_section"."asms_id"= ' || "p_amcl_id" || ')';
        ELSE
            "v_str1" := 'and ("Adm_School_M_Class"."ASMCL_Id" = ' || "p_asmcl_id" || ')';
        END IF;
    ELSE
        "v_str1" := ' ';
    END IF;

    IF "p_amst_id" = 1 THEN
        "v_temp" := 0;
        "v_temphead" := 0;
        "v_headid" := 'D%';
        "v_sqlhead" := 'NULL';

        IF "p_mi_id" = '4' THEN
            IF "p_userid" = '364' THEN
                IF "p_trmr_id" = '0' THEN
                    "v_query" := ';with cte as(SELECT DISTINCT "Adm_M_Student"."AMST_Id", COALESCE("Adm_M_Student"."AMST_FirstName",'''') || '' '' || COALESCE("Adm_M_Student"."AMST_MiddleName",'''') || '' '' || COALESCE("Adm_M_Student"."AMST_LastName",'''') as "Name", "Adm_M_Student"."AMST_AdmNo", CASE WHEN "Fee_Y_Payment"."fyp_receipt_no" LIKE ''' || "v_headid" || ''' OR "Fee_Y_Payment"."fyp_receipt_no" ~ ''^[0-9]+$'' THEN '' '' ELSE "Fee_Y_Payment"."fyp_receipt_no" END as "fyp_receipt_no", CASE WHEN "Fee_Y_Payment"."fyp_receipt_no" LIKE ''' || "v_headid" || ''' OR "Fee_Y_Payment"."fyp_receipt_no" ~ ''^[0-9]+$'' THEN '' '' ELSE CAST("Fee_Y_Payment"."FYP_Date" AS DATE)::TEXT END as "date", SUM("Fee_Student_Status"."FSS_ToBePaid") AS "Balance", SUM("Fee_Student_Status"."FSS_PaidAmount") AS "paid", SUM("Fee_Student_Status"."fss_totaltobepaid") as "total", "Adm_School_M_Class"."ASMCL_ClassName", "Adm_School_M_Section"."ASMC_SectionName", SUM("FSS_OBArrearAmount") "opening_balance", SUM("FSS_OBExcessAmount") "Excess", SUM("FSS_WaivedAmount") as "Waived", SUM("FSS_RefundAmount") as "refunded", SUM("FSS_AdjustedAmount") "adjusted", "Fee_Master_Terms"."FMT_Name", "Fee_Master_Terms"."fmt_id", "TR_Master_Route"."TRMR_RouteName", "FMCC_ConcessionName", "TRMR_RouteNo" FROM "Fee_Student_Status" INNER JOIN "Fee_Y_Payment_School_Student" ON "Fee_Y_Payment_School_Student"."AMST_Id" = "Fee_Student_Status"."AMST_Id" INNER JOIN "Fee_Y_Payment" ON "Fee_Y_Payment_School_Student"."FYP_Id" = "Fee_Y_Payment"."FYP_Id" INNER JOIN "Fee_Master_Terms_FeeHeads" ON "Fee_Master_Terms_FeeHeads"."FMH_Id" = "Fee_Student_Status"."FMH_Id" AND "Fee_Master_Terms_FeeHeads"."FTI_Id" = "Fee_Student_Status"."FTI_Id" INNER JOIN "Adm_M_Student" ON "Adm_M_Student"."AMST_Id" = "Fee_Y_Payment_School_Student"."AMST_Id" INNER JOIN "Fee_Master_Group" ON "Fee_Master_Group"."FMG_Id" = "Fee_Student_Status"."FMG_Id" INNER JOIN "Adm_School_Y_Student" ON "Adm_M_Student"."AMST_Id" = "Adm_School_Y_Student"."AMST_Id" INNER JOIN "Adm_School_M_Class" ON "Adm_School_Y_Student"."ASMCL_Id" = "Adm_School_M_Class"."ASMCL_Id" INNER JOIN "Adm_School_M_Section" ON "Adm_School_Y_Student"."ASMS_Id" = "Adm_School_M_Section"."ASMS_Id" INNER JOIN "Fee_Master_Terms" ON "Fee_Master_Terms_FeeHeads"."FMT_Id" = "Fee_Master_Terms"."FMT_Id" INNER JOIN "Adm_School_M_Academic_Year" ON "Adm_School_M_Academic_Year"."ASMAY_Id" = "Adm_School_Y_Student"."ASMAY_Id" AND "Adm_School_M_Academic_Year"."ASMAY_Id" = "fee_student_status"."ASMAY_Id" INNER JOIN "trn"."TR_Student_Route" ON "trn"."TR_Student_Route"."AMST_Id" = "Adm_M_Student"."AMST_Id" INNER JOIN "trn"."TR_Master_Route" ON "trn"."TR_Student_Route"."TRMR_Id" = "trn"."TR_Master_Route"."TRMR_Id" INNER JOIN "Fee_Master_Concession" ON "Fee_Master_Concession"."FMCC_Id" = "Adm_M_Student"."AMST_Concession_Type" WHERE ("Adm_School_Y_Student"."asmay_id" = ''' || "p_amay_id" || ''') AND ("Adm_M_Student"."AMST_ActiveFlag" = 1) AND ("Adm_School_Y_Student"."AMAY_ActiveFlag" = 1) AND ("Adm_M_Student"."AMST_SOL" = ''S'') AND ("Fee_Y_Payment"."user_id" = ''' || "p_userid" || ''') AND ("Fee_Y_Payment"."MI_Id" = ''' || "p_mi_id" || ''') AND ("Fee_Student_Status"."FMH_Id" NOT IN (100)) AND ("Fee_Master_Terms_FeeHeads"."FMT_Id" IN (' || "p_fmt_id" || ')) ' || "v_str1" || ' AND ("Fee_Student_Status"."FSS_PaidAmount" > 0 OR "Fee_Student_Status"."FSS_ToBePaid" > 0) AND ("Fee_Student_Status"."FMG_Id" IN (SELECT DISTINCT "FMG_Id" FROM "Fee_Master_Group_Grouping" INNER JOIN "Fee_Master_Group_Grouping_Groups" ON "Fee_Master_Group_Grouping"."FMGG_Id" = "Fee_Master_Group_Grouping_Groups"."FMGG_Id" WHERE "FMGG_GroupCode" = ''1'' AND "FMGG_ActiveFlag" = 1 AND "MI_Id" = ''' || "p_mi_id" || ''' AND "Fee_Master_Group_Grouping"."FMGG_Id" IN (' || "p_fmgg_id" || '))) AND "trn"."TR_Student_Route"."ASMAY_Id" = ''' || "p_amay_id" || ''' GROUP BY "Adm_M_Student"."AMST_Id", "AMST_FirstName", "AMST_MiddleName", "AMST_LastName", "AMST_AdmNo", "fyp_receipt_no", "FYP_Date", "Adm_School_M_Class"."ASMCL_ClassName", "Adm_School_M_Section"."ASMC_SectionName", "Fee_Master_Terms"."FMT_Name", "Fee_Master_Terms"."fmt_id", "trn"."TR_Master_Route"."TRMR_RouteName", "FMCC_ConcessionName", "TRMR_RouteNo") SELECT "AMST_Id", "Name", "AMST_AdmNo", "fyp_receipt_no", REPLACE("date", ''1900-01-01'', '' '') as "date", SUM("Balance") as "Balance", SUM("paid") as "paid", SUM("total") as "Total", SUM("opening_balance") as "opening_balance", SUM("Excess") as "Excess", SUM("Waived") as "Waived", SUM("refunded") as "refunded", SUM("adjusted") as "adjusted", "ASMCL_ClassName", "ASMC_SectionName", "FMT_Name", "FMT_Id", "TRMR_RouteName", "FMCC_ConcessionName", "TRMR_RouteNo" FROM cte GROUP BY "AMST_Id", "AMST_AdmNo", "Name", "fyp_receipt_no", "date", "ASMCL_ClassName", "ASMC_SectionName", "FMT_Name", "fmt_id", "TRMR_RouteName", "FMCC_ConcessionName", "TRMR_RouteNo"';
                ELSE
                    "v_query" := ';with cte as(SELECT DISTINCT "Adm_M_Student"."AMST_Id", COALESCE("Adm_M_Student"."AMST_FirstName",'''') || '' '' || COALESCE("Adm_M_Student"."AMST_MiddleName",'''') || '' '' || COALESCE("Adm_M_Student"."AMST_LastName",'''') as "Name", "Adm_M_Student"."AMST_AdmNo", CASE WHEN "Fee_Y_Payment"."fyp_receipt_no" LIKE ''' || "v_headid" || ''' OR "Fee_Y_Payment"."fyp_receipt_no" ~ ''^[0-9]+$'' THEN '' '' ELSE "Fee_Y_Payment"."fyp_receipt_no" END as "fyp_receipt_no", CASE WHEN "Fee_Y_Payment"."fyp_receipt_no" LIKE ''' || "v_headid" || ''' OR "Fee_Y_Payment"."fyp_receipt_no" ~ ''^[0-9]+$'' THEN '' '' ELSE CAST("Fee_Y_Payment"."FYP_Date" AS DATE)::TEXT END as "date", SUM("Fee_Student_Status"."FSS_ToBePaid") AS "Balance", SUM("Fee_Student_Status"."FSS_PaidAmount") AS "paid", SUM("Fee_Student_Status"."fss_totaltobepaid") as "total", "Adm_School_M_Class"."ASMCL_ClassName", "Adm_School_M_Section"."ASMC_SectionName", SUM("FSS_OBArrearAmount") "opening_balance", SUM("FSS_OBExcessAmount") "Excess", SUM("FSS_WaivedAmount") as "Waived", SUM("FSS_RefundAmount") as "refunded", SUM("FSS_AdjustedAmount") "adjusted", "Fee_Master_Terms"."FMT_Name", "Fee_Master_Terms"."fmt_id", "TR_Master_Route"."TRMR_RouteName", "FMCC_ConcessionName", "TRMR_RouteNo" FROM "Fee_Student_Status" INNER JOIN "Fee_Y_Payment_School_Student" ON "Fee_Y_Payment_School_Student"."AMST_Id" = "Fee_Student_Status"."AMST_Id" INNER JOIN "Fee_Y_Payment" ON "Fee_Y_Payment_School_Student"."FYP_Id" = "Fee_Y_Payment"."FYP_Id" INNER JOIN "Fee_Master_Terms_FeeHeads" ON "Fee_Master_Terms_FeeHeads"."FMH_Id" = "Fee_Student_Status"."FMH_Id" AND "Fee_Master_Terms_FeeHeads"."FTI_Id" = "Fee_Student_Status"."FTI_Id" INNER JOIN "Adm_M_Student" ON "Adm_M_Student"."AMST_Id" = "Fee_Y_Payment_School_Student"."AMST_Id" INNER JOIN "Fee_Master_Group" ON "Fee_Master_Group"."FMG_Id" = "Fee_Student_Status"."FMG_Id" INNER JOIN "Adm_School_Y_Student" ON "Adm_M_Student"."AMST_Id" = "Adm_School_Y_Student"."AMST_Id" INNER JOIN "Adm_School_M_Class" ON "Adm_School_Y_Student"."ASMCL_Id" = "Adm_School_M_Class"."ASMCL_Id" INNER JOIN "Adm_School_M_Section" ON "Adm_School_Y_Student"."ASMS_Id" = "Adm_School_M_Section"."ASMS_Id" INNER JOIN "Fee_Master_Terms" ON "Fee_Master_Terms_FeeHeads"."FMT_Id" = "Fee_Master_Terms"."FMT_Id" INNER JOIN "Adm_School_M_Academic_Year" ON "Adm_School_M_Academic_Year"."ASMAY_Id" = "Adm_School_Y_Student"."ASMAY_Id" AND "Adm_School_M_Academic_Year"."ASMAY_Id" = "fee_student_status"."ASMAY_Id" INNER JOIN "trn"."TR_Student_Route" ON "trn"."TR_Student_Route"."AMST_Id" = "Adm_M_Student"."AMST_Id" INNER JOIN "trn"."TR_Master_Route" ON "trn"."TR_Student_Route"."TRMR_Id" = "trn"."TR_Master_Route"."TRMR_Id" INNER JOIN "Fee_Master_Concession" ON "Fee_Master_Concession"."FMCC_Id" = "Adm_M_Student"."AMST_Concession_Type" WHERE ("Adm_School_Y_Student"."asmay_id" = ''' || "p_amay_id" || ''') AND ("Adm_M_Student"."AMST_ActiveFlag" = 1) AND ("Adm_School_Y_Student"."AMAY_ActiveFlag" = 1) AND ("Adm_M_Student"."AMST_SOL" = ''S'') AND ("Fee_Y_Payment"."user_id" = ''' || "p_userid" || ''') AND ("Fee_Y_Payment"."MI_Id" = ''' || "p_mi_id" || ''') AND ("Fee_Student_Status"."FMH_Id" NOT IN (100)) AND ("Fee_Master_Terms_FeeHeads"."FMT_Id" IN (' || "p_fmt_id" || ')) AND ("Fee_Student_Status"."FSS_PaidAmount" > 0 OR "Fee_Student_Status"."FSS_ToBePaid" > 0) AND ("Fee_Student_Status"."FMG_Id" IN (SELECT DISTINCT "FMG_Id" FROM "Fee_Master_Group_Grouping" INNER JOIN "Fee_Master_Group_Grouping_Groups" ON "Fee_Master_Group_Grouping"."FMGG_Id" = "Fee_Master_Group_Grouping_Groups"."FMGG_Id" WHERE "FMGG_GroupCode" = ''1'' AND "FMGG_ActiveFlag" = 1 AND "MI_Id" = ''' || "p_mi_id" || ''' AND "Fee_Master_Group_Grouping"."FMGG_Id" IN (' || "p_fmgg_id" || '))) AND ("trn"."TR_Master_Route"."TRMR_Id" = ' || "p_trmr_id" || ') AND "trn"."TR_Student_Route"."ASMAY_Id" = ''' || "p_amay_id" || ''' GROUP BY "Adm_M_Student"."AMST_Id", "AMST_FirstName", "AMST_MiddleName", "AMST_LastName", "AMST_AdmNo", "fyp_receipt_no", "FYP_Date", "Adm_School_M_Class"."ASMCL_ClassName", "Adm_School_M_Section"."ASMC_SectionName", "Fee_Master_Terms"."FMT_Name", "Fee_Master_Terms"."fmt_id", "trn"."TR_Master_Route"."TRMR_RouteName", "FMCC_ConcessionName", "TRMR_RouteNo") SELECT "AMST_Id", "Name", "AMST_AdmNo", "fyp_receipt_no", REPLACE("date", ''1900-01-01'', '' '') as "date", SUM("Balance") as "Balance", SUM("paid") as "paid", SUM("total") as "Total", SUM("opening_balance") as "opening_balance", SUM("Excess") as "Excess", SUM("Waived") as "Waived", SUM("refunded") as "refunded", SUM("adjusted") as "adjusted", "ASMCL_ClassName", "ASMC_SectionName", "FMT_Name", "FMT_Id", "TRMR_RouteName", "FMCC_ConcessionName", "TRMR_RouteNo" FROM cte GROUP BY "AMST_Id", "AMST_AdmNo", "Name", "fyp_receipt_no", "date", "ASMCL_ClassName", "ASMC_SectionName", "FMT_Name", "fmt_id", "TRMR_RouteName", "FMCC_ConcessionName", "TRMR_RouteNo"';
                END IF;
            ELSE
                "v_query" := ';with cte as(SELECT DISTINCT "Adm_M_Student"."AMST_Id", COALESCE("Adm_M_Student"."AMST_FirstName",'''') || '' '' || COALESCE("Adm_M_Student"."AMST_MiddleName",'''') || '' '' || COALESCE("Adm_M_Student"."AMST_LastName",'''') as "Name", "Adm_M_Student"."AMST_AdmNo", CASE WHEN "Fee_Y_Payment"."fyp_receipt_no" LIKE ''' || "v_headid" || ''' OR "Fee_Y_Payment"."fyp_receipt_no" ~ ''^[0-9]+$'' THEN '' '' ELSE "Fee_Y_Payment"."fyp_receipt_no" END as "fyp_receipt_no", CASE WHEN "Fee_Y_Payment"."fyp_receipt_no" LIKE ''' || "v_headid" || ''' OR "Fee_Y_Payment"."fyp_receipt_no" ~ ''^[0-9]+$'' THEN '' '' ELSE CAST("Fee_Y_Payment"."FYP_Date" AS DATE)::TEXT END as "date", SUM("Fee_Student_Status"."FSS_ToBePaid") AS "Balance", SUM("Fee_Student_Status"."FSS_PaidAmount") AS "paid", SUM("Fee_Student_Status"."fss_totaltobepaid") as "total", "Adm_School_M_Class"."ASMCL_ClassName", "Adm_School_M_Section"."ASMC_SectionName", "Fee_Master_Terms"."FMT_Name", "Fee_Master_Terms"."fmt_id", "FMCC_ConcessionName" FROM "Fee_Student_Status" INNER JOIN "Fee_Y_Payment_School_Student" ON "Fee_Y_Payment_School_Student"."AMST_Id" = "Fee_Student_Status"."AMST_Id" INNER JOIN "Fee_Y_Payment" ON "Fee_Y_Payment_School_Student"."FYP_Id" = "Fee_Y_Payment"."FYP_Id" INNER JOIN "Fee_Master_Terms_FeeHeads" ON "Fee_Master_Terms_FeeHeads"."FMH_Id" = "Fee_Student_Status"."FMH_Id" AND "Fee_Master_Terms_FeeHeads"."FTI_Id" = "Fee_Student_Status"."FTI_Id" INNER JOIN "Adm_M_Student" ON "Adm_M_Student"."AMST_Id" = "Fee_Y_Payment_School_Student"."AMST_Id" INNER JOIN "Fee_Master_Group" ON "Fee_Master_Group"."FMG_Id" = "Fee_Student_Status"."FMG_Id" INNER JOIN "Adm_School_Y_Student" ON "Adm_M_Student"."AMST_Id" = "Adm_School_Y_Student"."AMST_Id" INNER JOIN "Adm_School_M_Class" ON "Adm_School_Y_Student"."ASMCL_Id" = "Adm_School_M_Class"."ASMCL_Id" INNER JOIN "Adm_School_M_Section" ON "Adm_School_Y_Student"."ASMS_Id" = "Adm_School_M_Section"."ASMS_Id" INNER JOIN "Fee_Master_Terms" ON "Fee_Master_Terms_FeeHeads"."FMT_Id" = "Fee_Master_Terms"."FMT_Id" INNER JOIN "Adm_School_M_Academic_Year" ON "Adm_School_M_Academic_Year"."ASMAY_Id" = "Adm_School_Y_Student"."ASMAY_Id" AND "Adm_School_M_Academic_Year"."ASMAY_Id" = "fee_student_status"."ASMAY_Id" INNER JOIN "Fee_Master_Concession" ON "Fee_Master_Concession"."FMCC_Id" = "Adm_M_Student"."AMST_Concession_Type" WHERE ("Adm_School_Y_Student"."asmay_id" = ''' || "p_amay_id" || ''') AND ("Adm_M_Student"."AMST_ActiveFlag" = 1) AND ("Adm_School_Y_Student"."AMAY_ActiveFlag" = 1) AND ("Adm_M_Student"."AMST_SOL" = ''S'') AND ("Fee_Y_Payment"."user_id" = ''' || "p_userid" || ''') AND ("Fee_Y_Payment"."MI_Id" = ''' || "p_mi_id" || ''') AND ("Fee_Student_Status"."FMH_Id" NOT IN (100)) AND ("Fee_Master_Terms_FeeHeads"."FMT_Id" IN (' || "p_fmt_id" || ')) ' || "v_str1" || ' AND ("Fee_Student_Status"."FSS_PaidAmount" > 0 OR "Fee_Student_Status"."FSS_ToBePaid" > 0) AND ("Fee_Student_Status"."FMG_Id" IN (SELECT DISTINCT "FMG_Id" FROM "Fee_Master_Group_Grouping" INNER JOIN "Fee_Master_Group_Grouping_Groups" ON "Fee_Master_Group_Grouping"."FMGG_Id" = "Fee_Master_Group_Grouping_Groups"."FMGG_Id" WHERE "FMGG_GroupCode" = ''1'' AND "FMGG_ActiveFlag" = 1 AND "MI_Id" = ''' || "p_mi_id" || ''' AND "Fee_Master_Group_Grouping"."FMGG_Id" IN (' || "p_fmgg_id" || '))) GROUP BY "Adm_M_Student"."AMST_Id", "AMST_FirstName", "AMST_MiddleName", "AMST_LastName", "AMST_AdmNo", "fyp_receipt_no", "FYP_Date", "Adm_School_M_Class"."ASMCL_ClassName", "Adm_School_M_Section"."ASMC_SectionName", "Fee_Master_Terms"."FMT_Name", "Fee_Master_Terms"."fmt_id", "FMCC_ConcessionName") SELECT "AMST_Id", "Name", "AMST_AdmNo", "fyp_receipt_no", REPLACE("date", ''1900-01-01'', '' '') as "date", SUM("Balance") as "Balance", SUM("paid") as "paid", SUM("total") as "Total", "ASMCL_ClassName", "ASMC_SectionName", "FMT_Name", "FMT_Id", "FMCC_ConcessionName" FROM cte GROUP BY "AMST_Id", "AMST_AdmNo", "Name", "fyp_receipt_no", "date", "ASMCL_ClassName", "ASMC_SectionName", "FMT_Name", "fmt_id", "FMCC_ConcessionName"';
            END IF;
        ELSE
            IF "p_trmr_id" = '0' THEN
                "v_query" := ';with cte as(SELECT DISTINCT "Adm_M_Student"."AMST_Id", COALESCE("Adm_M_Student"."AMST_FirstName",'''') || '' '' || COALESCE("Adm_M_Student"."AMST_MiddleName",'''') || '' '' || COALESCE("Adm_M_Student"."AMST_LastName",'''') as "Name", "Adm_M_Student"."AMST_AdmNo", CASE WHEN "Fee_Y_Payment"."fyp_receipt_no" LIKE ''' || "v_headid" || ''' OR "Fee_Y_Payment"."fyp_receipt_no" ~ ''^[0-9]+$'' THEN '' '' ELSE "Fee_Y_Payment"."fyp_receipt_no" END as "fyp_receipt_no", CASE WHEN "Fee_Y_Payment"."fyp_receipt_no" LIKE ''' || "v_headid" || ''' OR "Fee_Y_Payment"."fyp_receipt_no" ~ ''^[0-9]+$'' THEN '' '' ELSE CAST("Fee_Y_Payment"."FYP_Date" AS DATE)::TEXT END as "date", SUM("Fee_Student_Status"."FSS_ToBePaid") AS "Balance", SUM("Fee_T_Payment"."FTP_Paid_Amt") AS "paid", SUM("Fee_Student_Status"."fss_totaltobepaid") as "total", "Adm_School_M_Class"."ASMCL_ClassName", "Adm_School_M_Section"."ASMC_SectionName", "Fee_Master_Terms"."FMT_Name", "Fee_Master_Terms"."fmt_id" FROM "Fee_Student_Status" INNER JOIN "Fee_Y_Payment_School_Student" ON "Fee_Y_Payment_School_Student"."AMST_Id" = "Fee_Student_Status"."AMST_Id" INNER JOIN "Fee_Y_Payment" ON "Fee_Y_Payment_School_Student"."FYP_Id" = "Fee_Y_Payment"."FYP_Id" INNER JOIN "Fee_T_Payment" ON "Fee_Y_Payment"."FYP_Id" = "Fee_T_Payment"."FYP_Id" AND "Fee_T_Payment"."FMA_Id" = "Fee_Student_Status"."FMA_Id" INNER JOIN "Fee_Master_Terms_FeeHeads" ON "Fee_Master_Terms_FeeHeads"."FMH_Id" = "Fee_Student_Status"."FMH_Id" AND "Fee_Master_Terms_FeeHeads"."FTI_Id" = "Fee_Student_Status"."FTI_Id" INNER JOIN "Adm_M_Student" ON "Adm_M_Student"."AMST_Id" = "Fee_Y_Payment_School_Student"."AMST_Id" INNER JOIN "Fee_Master_Group" ON "Fee_Master_Group"."FMG_Id" = "Fee_Student_Status"."FMG_Id" INNER JOIN "Adm_School_Y_Student" ON "Adm_M_Student"."AMST_Id" = "Adm_School_Y_Student"."AMST_Id" INNER JOIN "Adm_School_M_Class" ON "Adm_School_Y_Student"."ASMCL_Id" = "Adm_School_M_Class"."ASMCL_Id" INNER JOIN "Adm_School_M_Section" ON "Adm_School_Y_Student"."ASMS_Id" = "Adm_School_M_Section"